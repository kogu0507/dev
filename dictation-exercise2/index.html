<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="data:;base64,iVBORw0KGgo=" />

  <title>Mock Dictation Exam</title>

  <link rel="stylesheet" href="./style.css" />
  <style>
    /* style.cssã«ä»¥é™ã—ã¾ã—ãŸ */
    /* Refactored simple-tab-component/style.css v2.1
   â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
   1. ãƒ«ãƒ¼ãƒˆå¤‰æ•°ï¼ˆã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã‚„ã™ã„ï¼‰
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
:root {
  /* ãƒ•ã‚©ãƒ³ãƒˆãƒ»å¹…ãƒ»ã‚¹ãƒšãƒ¼ã‚·ãƒ³ã‚° */
  --stc-font-family: sans-serif;
  --stc-max-width: 800px;
  --stc-spacing: 10px;

  /* è‰² */
  --stc-border-color: #ccc;
  --stc-bg: #fff;
  --stc-bg-alt: #f0f0f0;       /* ã‚¿ãƒ–æœªé¸æŠæ™‚èƒŒæ™¯ */
  --stc-bg-hover: #e0e0e0;     /* ã‚¿ãƒ–ãƒ›ãƒãƒ¼æ™‚èƒŒæ™¯ */
  --stc-color: #333;           /* ãƒ¡ã‚¤ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ */
  --stc-color-alt: #555;       /* è£œåŠ©ãƒ†ã‚­ã‚¹ãƒˆ */

  /* ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã‚«ãƒ©ãƒ¼ï¼ˆé‡è¦è¦ç´ ç”¨ï¼‰ */
  --stc-accent: #007bff;
  --stc-accent-hover: #0056b3;

  /* è§’ä¸¸ãƒ»ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
  --stc-radius: 4px;
  --stc-transition: 0.2s;

  /* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ */
  --stc-focus-outline: 2px solid var(--stc-accent);
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
   2. ã‚³ãƒ³ãƒ†ãƒŠå…¨ä½“
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.simple-tab-component-container {
  font-family: var(--stc-font-family);
  max-width: var(--stc-max-width);
  margin: calc(var(--stc-spacing) * 2) auto;
  border: 1px solid var(--stc-border-color);
  border-radius: var(--stc-radius);
  background: var(--stc-bg);
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
  overflow: hidden;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
   3. ã‚¿ãƒ–ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯¾å¿œï¼‰
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.simple-tab-component-container .tabs {
  display: flex;
  padding: 0 var(--stc-spacing);
  border-bottom: 1px solid var(--stc-border-color);
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none; /* Firefox */
}
.simple-tab-component-container .tabs::-webkit-scrollbar {
  display: none;        /* Chrome/Safari */
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
   4. ã‚¿ãƒ–ãƒœã‚¿ãƒ³
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.simple-tab-component-container .tab-button {
  flex: 0 0 auto;
  margin-right: var(--stc-spacing);
  padding: var(--stc-spacing) calc(var(--stc-spacing) * 2);
  background: var(--stc-bg-alt);
  border: 1px solid transparent;
  border-bottom: none;
  border-top-left-radius: var(--stc-radius);
  border-top-right-radius: var(--stc-radius);
  color: var(--stc-color-alt);
  font-size: 1rem;
  cursor: pointer;
  transition: background var(--stc-transition), border-color var(--stc-transition);
  outline: none;
}

/* ãƒ›ãƒãƒ¼ */
.simple-tab-component-container .tab-button:hover:not(.active) {
  background: var(--stc-bg-hover);
}

/* ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ */
.simple-tab-component-container .tab-button:focus-visible {
  outline: var(--stc-focus-outline);
}

/* ã‚¢ã‚¯ãƒ†ã‚£ãƒ– */
.simple-tab-component-container .tab-button.active {
  background: var(--stc-bg);
  border-color: var(--stc-border-color);
  color: var(--stc-color);
  font-weight: bold;
  cursor: default;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
   5. ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
.simple-tab-component-container .tab-content {
  padding: var(--stc-spacing);
  background: var(--stc-bg);
}

/* è¡¨ç¤ºåˆ‡æ›¿ */
.simple-tab-component-container .tab-pane {
  display: none;
}
.simple-tab-component-container .tab-pane.active {
  display: block;
}

/* ã‚»ã‚¯ã‚·ãƒ§ãƒ³å…±é€š */
.simple-tab-component-container section {
  margin-bottom: calc(var(--stc-spacing) * 1.5);
}

/* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼é¢¨ãƒ†ã‚­ã‚¹ãƒˆ */
.simple-tab-component-container .mde-exercise-selection-section,
.simple-tab-component-container .mde-exercise-section,
.simple-tab-component-container .mde-playback-info,
.simple-tab-component-container .mde-exercise-info,
.simple-tab-component-container .mde-answer-display {
  color: #666;
  font-style: italic;
}

/* ã‚¹ã‚³ã‚¢ï¼ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼æ  */
.simple-tab-component-container .score-container,
.simple-tab-component-container .mde-player-section {
  border: 1px solid var(--stc-border-color);
  border-radius: var(--stc-radius);
  padding: var(--stc-spacing);
  background: #fafafa;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
   6. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…è¦ç´ 
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
/* å†ç”Ÿç¯„å›²è¨­å®š */
.mde-play-range {
  display: flex;
  flex-wrap: wrap;
  gap: var(--stc-spacing);
  margin-bottom: var(--stc-spacing);
}
.mde-play-range label,
.mde-play-range input {
  font-size: 0.9rem;
}
.mde-play-range input[type="number"] {
  width: 4em;
  padding: 0.2em;
  border: 1px solid var(--stc-border-color);
  border-radius: var(--stc-radius);
}

/* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ç¾¤ */
.mde-control-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: var(--stc-spacing);
  align-items: center;
}
/* å†ç”Ÿãƒ»åœæ­¢ç­‰ã®ãƒœã‚¿ãƒ³ */
.mde-control-button {
  padding: 0.5em 1em;
  background: var(--stc-accent);
  color: #fff;
  border: none;
  border-radius: var(--stc-radius);
  cursor: pointer;
  transition: background var(--stc-transition);
}
.mde-control-button:hover {
  background: var(--stc-accent-hover);
}

/* å†ç”Ÿã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º */
.mde-playback-status {
  flex: 1;
  font-size: 0.9rem;
  color: var(--stc-color);
}

/* ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ */
.mde-control-buttons input[type="range"] {
  vertical-align: middle;
}

/* â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
   7. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” */
@media (max-width: 600px) {
  .simple-tab-component-container .tabs {
    flex-wrap: wrap;
  }
  .simple-tab-component-container .tab-button {
    flex: 100%;
    text-align: left;
  }
  .mde-play-range,
  .mde-control-buttons {
    flex-direction: column;
    align-items: stretch;
  }
}

  </style>



  <!-- simple-tab-componentï¼ˆæ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰ -->
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/gh/kogu0507/module@v2.7.0/components/simple-tab-component/style.min.css" />
  <script
    src="https://cdn.jsdelivr.net/gh/kogu0507/module@v2.7.0/components/simple-tab-component/script.min.js"></script>

</head>

<body>
  <h1 style="display:none;">ï¼ˆWordPressã§h1ã¯æœ¬ä½“å´ã§å‡ºã™å‰æãªã‚‰éš ã™ï¼‰</h1>
  <h2>Mock Dictation Exam</h2>

  <!-- ====== Exercises JSON ======
       ã“ã“ã‚’æ›¸ãæ›ãˆã‚Œã°èª²é¡Œã‚’å¢—ã‚„ã›ã¾ã™ -->
  <script id="mde-json-data" type="application/json">
[
  {
    "id": "001",
    "meiURL": "./melody-dictation-001.mei",
    "exerciseInfo": "ãƒé•·èª¿ 4/4æ‹å­ 8å°ç¯€",
    "tonicChordSpec": { "notes": ["C4","E4","G4"] },
    "playbackDef": [
      { "range": "1-8", "interval": 20 },
      { "range": "1-4", "interval": 20 },
      { "range": "1-4", "interval": 20 },
      { "range": "1-8", "interval": 20 },
      { "range": "5-8", "interval": 20 },
      { "range": "5-8", "interval": 20 },
      { "range": "1-8", "interval": 120 }
    ],
    "endBellSpec": { "notes": ["C5","G4","E4","C4"] }
  },
  {
    "id": "002",
    "meiURL": "./melody-dictation-002.mei",
    "exerciseInfo": "ãƒé•·èª¿ 4/4æ‹å­ 8å°ç¯€",
    "tonicChordSpec": { "notes": ["C4","E4","G4"] },
    "playbackDef": [
      { "range": "1-2", "interval": 3 }
      
    ],
    "endBellSpec": { "notes": ["C5","G4","E4","C4"] }
  }
]
  </script>


  <!-- 
[
  {
    "id": "001",
    "meiURL": "./melody-dictation-001.mei",
    "exerciseInfo": "ãƒé•·èª¿ 4/4æ‹å­ 8å°ç¯€",
    "tonicChordSpec": { "notes": ["C4","E4","G4"] },
    "playbackDef": [
      { "range": "1-8", "interval": 20 },
      { "range": "1-4", "interval": 20 },
      { "range": "1-4", "interval": 20 },
      { "range": "1-8", "interval": 20 },
      { "range": "5-8", "interval": 20 },
      { "range": "5-8", "interval": 20 },
      { "range": "1-8", "interval": 120 }
    ],
    "endBellSpec": { "notes": ["C5","G4","E4","C4"] }
  }
]
  
  
  -->

  <!-- ====== (å‚è€ƒç”¨) JSON Schemaã‚’åŸ‹ã‚ã¦ãŠãï¼ˆå®Ÿè¡Œæ™‚ã«ã¯æœªä½¿ç”¨ï¼‰ ====== -->
  <script id="mde-json-schema" type="application/json">
        {
        "$schema": "http://json-schema.org/draft-07/schema#",
        "$id": "https://example.com/mde-exercise.schema.json",
        "title": "Melody Dictation Exercises",
        "type": "array",
        "items": {
            "type": "object",
            "required": ["id", "meiURL", "exerciseInfo", "playbackDef"],
            "properties": {
            "id": {
                "type": "string",
                "pattern": "^[A-Za-z0-9_-]+$"
            },
            "meiURL": { "type": "string" },
            "exerciseInfo": { "type": "string" },
            "playbackDef": {
                "type": "array",
                "minItems": 1,
                "items": {
                "type": "object",
                "required": ["range", "interval"],
                "properties": {
                    "range": {
                    "type": "string",
                    "pattern": "^\\d+(-\\d+)?(,\\d+(-\\d+)?)*$"
                    },
                    "interval": {
                    "type": "number",
                    "minimum": 0
                    }
                },
                "additionalProperties": false
                }
            },
            "tonicChordSpec": { "$ref": "#/$defs/ChordSpec" },
            "endBellSpec": { "$ref": "#/$defs/ChordSpec" },
            "notes": { "type": "string" }
            },
            "additionalProperties": false
        },
        "$defs": {
            "ChordSpec": {
            "type": ["object", "null"],
            "properties": {
                "notes": {
                "type": "array",
                "items": { "type": "string", "pattern": "^[A-Ga-g][#b]?\\d$" },
                "minItems": 1
                },
                "durationSec": {
                "type": "number",
                "minimum": 0
                },
                "velocity": {
                "type": "number",
                "minimum": 0,
                "maximum": 1
                }
            },
            "required": ["notes"],
            "additionalProperties": false
            }
        }
        }

  </script>

  <!-- ====== ã‚¿ãƒ–UI ====== -->
  <div class="simple-tab-component-container" data-default-tab="exercise-selection" data-deep-link="true">
    <div class="tabs">
      <button class="tab-button" data-tab="exercise-selection">èª²é¡Œé¸æŠ</button>
      <button class="tab-button" data-tab="exercise">èª²é¡Œ</button>
      <button class="tab-button" data-tab="answer">è§£ç­”</button>
      <button class="tab-button" data-tab="settings">è¨­å®š</button>
    </div>

    <div class="tab-content">
      <!-- èª²é¡Œé¸æŠã‚¿ãƒ– -->
      <div id="exercise-selection" class="tab-pane">
        <h3 style="display:none;">èª²é¡Œé¸æŠ</h3>
        <section class="mde-exercise-selection-section">
          JSONã‹ã‚‰èª²é¡Œã‚’èª­è¾¼ä¸­...
        </section>
      </div>

      <!-- èª²é¡Œã‚¿ãƒ– -->
      <div id="exercise" class="tab-pane">
        <h3 style="display:none;">èª²é¡Œ</h3>

        <section class="mde-exercise-section">
          <div class="mde-exercise-info">èª²é¡Œæƒ…å ±ã‚’èª­è¾¼ä¸­...</div>
          <div class="mde-playback-info">ãƒ—ãƒ¬ã‚¤ãƒãƒƒã‚¯æƒ…å ±ã‚’èª­è¾¼ä¸­...</div>
        </section>

        <section class="score-container" id="exercise-score-container">
          <!-- ä»Šå›ã¯èª²é¡Œå´ã«æ¥½è­œã‚’å‡ºã•ãªã„ä»•æ§˜ã§ã‚‚OKã€‚å¿…è¦ãªã‚‰è¡¨ç¤º -->
        </section>

        <section class="mde-player-section" id="exercise-player-section">
          ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼èª­è¾¼ä¸­...
        </section>
      </div>

      <!-- è§£ç­”ã‚¿ãƒ– -->
      <div id="answer" class="tab-pane">
        <h3 style="display:none;">è§£ç­”</h3>

        <section class="mde-answer-display">
          <div class="score-container" id="answer-score-container">è§£ç­”æ¥½è­œã‚’èª­è¾¼ä¸­...</div>
        </section>

        <section class="mde-player-section" id="answer-player-section">
          ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼èª­è¾¼ä¸­...
        </section>
      </div>

      <!-- è¨­å®šã‚¿ãƒ– -->
      <div id="settings" class="tab-pane">
        <h3 style="display:none;">è¨­å®š</h3>
        <section class="mde-player-setting-section">
          <p>ï¼ˆå°†æ¥ç”¨è¨­å®šUIã‚’ã“ã“ã«ï¼‰</p>
        </section>
        <section class="mde-playlist-setting-section">
          <p>ï¼ˆplaybackDefç·¨é›†UIã‚’ä½œã‚‹ãªã‚‰ã“ã“ã«ï¼‰</p>
        </section>
      </div>
    </div>
  </div>

  <!-- ====== ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ ====== -->
  <template id="mde-player-template">
    <!-- data-role ã§JSãŒè¦ç´ ã‚’å–å¾—ã—ã‚„ã™ãã™ã‚‹ -->
    <div class="mde-play-range" data-player-mode="practice">
      <label>é–‹å§‹å°ç¯€:
        <input type="number" data-role="start-measure" value="1" min="1" />
      </label>
      <label>çµ‚äº†å°ç¯€:
        <input type="number" data-role="end-measure" value="8" min="1" />
      </label>
      <button class="mde-control-button" data-role="play-range">æŒ‡å®šç¯„å›²å†ç”Ÿ</button>
    </div>

    <div class="mde-control-buttons">
      <!-- âœ… ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºé ˜åŸŸï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ï¼†ãƒ‡ãƒãƒƒã‚°å‘ã‘ï¼‰ -->
      <div class="mde-playback-status" data-role="status" aria-live="polite">
        ğŸ§ å†ç”Ÿã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™
      </div>

      <button class="mde-control-button" data-role="start-playlist">ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†ç”Ÿ</button>
      <button class="mde-control-button" data-role="stop">åœæ­¢</button>
      <button class="mde-control-button" data-role="mute">ãƒŸãƒ¥ãƒ¼ãƒˆ</button>
      <label style="display:flex; align-items:center; gap:4px;">
        Vol:
        <input type="range" data-role="volume" min="0" max="100" value="50" />
      </label>
    </div>
  </template>


  <!-- =========================================================
       ãƒ¡ã‚¤ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
       ========================================================= -->
  <script type="module">
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«èª­ã¿è¾¼ã¿
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    import { VerovioManager } from "https://cdn.jsdelivr.net/gh/kogu0507/module@v2.7.0/verovio/verovio-manager.min.js";
    import { loadToneJs } from "https://cdn.jsdelivr.net/gh/kogu0507/module@v2.7.0/tonejs/loader.min.mjs";
    import { loadToneJsMidi } from "https://cdn.jsdelivr.net/gh/kogu0507/module@v2.7.0/tonejs/tonejs-midi-loader.min.mjs";
    import Ajv from "https://cdn.skypack.dev/ajv";

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // å®šæ•°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const DEFAULT_CHORD_DURATION = 4;  // sec
    const FIXED_VELOCITY = 0.8; // 0ï½1
    const renderOptions = {
      svgViewBox: true,
      adjustPageHeight: true,
      pageWidth: 2100,
      breaks: "encoded",
      spacingStaff: 5,
      spacingSystem: 15,
      footer: "none",
      pageMarginTop: 0,
      pageMarginRight: 10,
      pageMarginBottom: 0,
      pageMarginLeft: 10,
      minLastJustification: 0
    };

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const delay = ms => new Promise(res => setTimeout(res, ms));
    function dbFromSliderValue(v) {
      // 0-100 -> -60dB to 0dB
      const minDb = -60;
      return minDb + (v / 100) * Math.abs(minDb);
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // è‡´å‘½çš„ JSON ã‚¨ãƒ©ãƒ¼ã‚’ç”»é¢è¡¨ç¤º
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function showFatalJsonError(messages) {
      document.body.innerHTML = `
      <div class="mde-error">
        <h2>JSON ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼</h2>
        <ul>
          ${messages.map(m => `<li>${m}</li>`).join("")}
        </ul>
      </div>`;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // å†ç”Ÿã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const playbackMessages = {
      playScore: (range) => `ğŸ¼ ï¼‘ï¼‰é€šå¥ï¼š${rangeToText(range)} å†ç”Ÿä¸­`,
      waitInterval: (sec) => `â± ï¼’ï¼‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«ï¼šæ¬¡ã®å†ç”Ÿã¾ã§ ${sec} ç§’ å¾…æ©Ÿä¸­`,
      bell: "ğŸ”” çµ‚äº†ãƒ™ãƒ«å†ç”Ÿä¸­...",
      playlistEnd: "âœ… ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†ç”Ÿå®Œäº†",
      stop: "â¹ åœæ­¢ã—ã¾ã—ãŸ"
    };


    /**
     * æŒ‡å®šã•ã‚ŒãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹
     * @param {string} message è¡¨ç¤ºã™ã‚‹å†…å®¹
     * @param {HTMLElement} el è¡¨ç¤ºå…ˆã®è¦ç´ ï¼ˆnullå¯ï¼‰
     */
    function updatePlaybackStatus(message, el) {
      if (el) el.textContent = message;
      console.log("[status]", message);
    }

    /**
     * [1, 8] -> "1-8å°ç¯€" ã®ã‚ˆã†ã«å¤‰æ›
     */
    function rangeToText(range) {
      if (!Array.isArray(range) || range.length !== 2) return "";
      return `${range[0]}-${range[1]}å°ç¯€`;
    }






    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // MDEPlayer ã‚¯ãƒ©ã‚¹ï¼šå†ç”Ÿãƒ­ã‚¸ãƒƒã‚¯ã‚’ä¸€å…ƒç®¡ç†
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    class MDEPlayer {
      constructor(exercise, renderOptions) {
        this.exercise = exercise;
        this.renderOptions = renderOptions;
        this.verovioManager = null;
        this.Tone = null;
        this.Midi = null;
        this.synth = null;
        this.playlistState = { timerId: null, index: 0, running: false };
        this.chordAbortController = null;
      }

      // Verovio & Tone.js åˆæœŸåŒ–
      async init() {
        this.verovioManager = new VerovioManager();
        await this.verovioManager.initialize();
        this.verovioManager.setRenderOptions(this.renderOptions);

        await loadToneJs();
        this.Tone = window.Tone;
        this.Midi = await loadToneJsMidi();
      }

      // æ¥½è­œè¡¨ç¤ºï¼ˆmeasureRange çœç•¥ã§å…¨ä½“è¡¨ç¤ºï¼‰
      async loadAndDisplayScore(containerId, measureRange = "") {
        try {
          const container = document.getElementById(containerId);
          if (!container) throw new Error(`container '${containerId}' not found`);
          await this.verovioManager.displaySvgFromUrl(
            this.exercise.meiURL,
            containerId,
            { measureRange }
          );
        } catch (err) {
          console.error("display error:", err);
          const c = document.getElementById(containerId);
          if (c) c.innerHTML = `<div class="mde-error">æ¥½è­œã‚¨ãƒ©ãƒ¼: ${err.message}</div>`;
        }
      }

      // ç¯„å›²æŒ‡å®š MIDI å†ç”Ÿ
      async playScore(range, statusEl) {
        return new Promise(async (resolve, reject) => {
          try {
            if (this.Tone.context.state !== "running") {
              await this.Tone.start();
            }
            if (!this.synth) {
              this.synth = new this.Tone.PolySynth(this.Tone.Synth, {
                oscillator: { type: "triangle" },
                envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 }
              }).toDestination();
            }

            this.Tone.Transport.stop();
            this.Tone.Transport.cancel();

            if (statusEl) updatePlaybackStatus(playbackMessages.playScore(range), statusEl);

            const midiArrBuf = await this.verovioManager.getMidiFromUrl(
              this.exercise.meiURL,
              { measureRange: range }
            );
            if (!midiArrBuf) {
              if (statusEl) updatePlaybackStatus("âš ï¸ MIDIãƒ‡ãƒ¼ã‚¿å–å¾—å¤±æ•—", statusEl);
              return reject(new Error("MIDI data null"));
            }

            const midi = new this.Midi(midiArrBuf);
            let maxEnd = 0;
            midi.tracks.forEach(track =>
              track.notes.forEach(note => {
                this.Tone.Transport.scheduleOnce(time => {
                  this.synth.triggerAttackRelease(note.name, note.duration, time, note.velocity);
                }, note.time);
                maxEnd = Math.max(maxEnd, note.time + note.duration);
              })
            );

            this.Tone.Transport.scheduleOnce(() => {
              if (statusEl) updatePlaybackStatus(`âœ… å†ç”Ÿå®Œäº†: ${rangeToText(range)}`, statusEl);
              resolve(maxEnd);
            }, maxEnd);

            this.Tone.Transport.start();
          } catch (e) {
            if (statusEl) updatePlaybackStatus(`âŒ å†ç”Ÿã‚¨ãƒ©ãƒ¼: ${e.message}`, statusEl);
            reject(e);
          }
        });
      }

      // ã‚³ãƒ¼ãƒ‰å†ç”Ÿï¼ˆãƒˆãƒ‹ãƒƒã‚¯ï¼ãƒ™ãƒ«ï¼‰â”€â”€ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¯¾å¿œ
      async playChord(chordSpec) {
        if (!chordSpec?.notes?.length) return;

        if (this.chordAbortController) {
          this.chordAbortController.abort();
        }
        this.chordAbortController = new AbortController();
        const { signal } = this.chordAbortController;

        const durationSec = chordSpec.durationSec ?? DEFAULT_CHORD_DURATION;
        if (this.Tone.context.state !== "running") {
          await this.Tone.start();
        }
        if (!this.synth) {
          this.synth = new this.Tone.PolySynth(this.Tone.Synth, {
            oscillator: { type: "triangle" },
            envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 }
          }).toDestination();
        }

        const now = this.Tone.now();
        this.synth.triggerAttackRelease(chordSpec.notes, durationSec, now, FIXED_VELOCITY);

        try {
          await new Promise((resolve, reject) => {
            const timeoutId = setTimeout(resolve, durationSec * 1000);
            signal.addEventListener("abort", () => {
              clearTimeout(timeoutId);
              reject(new Error("chord-aborted"));
            });
          });
        } catch (err) {
          if (err.message === "chord-aborted") {
            this.synth.releaseAll();
          } else {
            console.error("playChord error:", err);
          }
        } finally {
          this.chordAbortController = null;
        }
      }

      // ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†ç”Ÿ
      async playPlaylist(statusEl) {
        const playlist = this.exercise.playbackDef;
        if (!playlist?.length) {
          updatePlaybackStatus("âš ï¸ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“", statusEl);
          return;
        }

        this.stopAll(statusEl);
        this.playlistState.index = 0;
        this.playlistState.running = true;

        if (this.exercise.tonicChordSpec) {
          updatePlaybackStatus("ğŸµ ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰å†ç”Ÿä¸­...", statusEl);
          await this.playChord(this.exercise.tonicChordSpec);
        }

        while (this.playlistState.running && this.playlistState.index < playlist.length) {
          const entry = playlist[this.playlistState.index];

          updatePlaybackStatus(playbackMessages.playScore(entry.range), statusEl);
          try {
            await this.playScore(entry.range, statusEl);

            if (!this.playlistState.running) break;

            if (entry.interval && entry.interval > 0) {
              updatePlaybackStatus(playbackMessages.waitInterval(entry.interval), statusEl);
              await delay(entry.interval * 1000);
            }
          } catch (e) {
            console.warn("ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†ç”Ÿä¸­ã«ä¸­æ–­ã•ã‚Œã¾ã—ãŸ:", e);
            break;
          }

          this.playlistState.index++;
        }

        if (this.playlistState.running && this.exercise.endBellSpec) {
          updatePlaybackStatus(playbackMessages.bell, statusEl);
          await this.playChord(this.exercise.endBellSpec);
        }

        updatePlaybackStatus(playbackMessages.playlistEnd, statusEl);
        this.playlistState.running = false;
      }

      // åœæ­¢å‡¦ç†
      stopAll(statusEl) {
        if (this.chordAbortController) {
          this.chordAbortController.abort();
          this.chordAbortController = null;
        }
        this.playlistState.running = false;
        this.playlistState.index = 0;
        if (this.playlistState.timerId) {
          clearTimeout(this.playlistState.timerId);
          this.playlistState.timerId = null;
        }
        if (this.Tone?.Transport) {
          this.Tone.Transport.stop();
          this.Tone.Transport.cancel();
        }
        if (statusEl) updatePlaybackStatus(playbackMessages.stop, statusEl);
      }
    }


    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // UI åˆæœŸåŒ–ï¼šãƒœã‚¿ãƒ³ã‚’ player ãƒ¡ã‚½ãƒƒãƒ‰ã«æ¥ç¶š
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function setupPlayerUI(sectionEl) {
      const startInput = sectionEl.querySelector('[data-role="start-measure"]');
      const endInput = sectionEl.querySelector('[data-role="end-measure"]');
      const playRangeBtn = sectionEl.querySelector('[data-role="play-range"]');
      const startPlaylistBtn = sectionEl.querySelector('[data-role="start-playlist"]');
      const stopBtn = sectionEl.querySelector('[data-role="stop"]');
      const muteBtn = sectionEl.querySelector('[data-role="mute"]');
      const volumeSlider = sectionEl.querySelector('[data-role="volume"]');
      const statusEl = sectionEl.querySelector('[data-role="status"]');

      // ç¯„å›²å†ç”Ÿ
      playRangeBtn?.addEventListener("click", async () => {
        let s = parseInt(startInput.value, 10),
          e = parseInt(endInput.value, 10);
        if (isNaN(s) && isNaN(e)) {
          alert("æœ‰åŠ¹ãªå°ç¯€ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
          return;
        }
        const range = (!isNaN(s) && !isNaN(e) && e >= s)
          ? `${s}-${e}`
          : !isNaN(s)
            ? `${s}`
            : `${e}`;
        await player.playScore(range, statusEl);
      });

      // ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†ç”Ÿ
      startPlaylistBtn?.addEventListener("click", () => {
        player.playPlaylist(statusEl);
      });

      // åœæ­¢
      stopBtn?.addEventListener("click", () => {
        player.stopAll(statusEl);
      });

      // ãƒŸãƒ¥ãƒ¼ãƒˆ
      muteBtn?.addEventListener("click", () => {
        player.Tone.Destination.mute = !player.Tone.Destination.mute;
        muteBtn.textContent = player.Tone.Destination.mute ? "ãƒŸãƒ¥ãƒ¼ãƒˆè§£é™¤" : "ãƒŸãƒ¥ãƒ¼ãƒˆ";
      });

      // éŸ³é‡
      volumeSlider?.addEventListener("input", ev => {
        player.Tone.Destination.volume.value = dbFromSliderValue(Number(ev.target.value));
      });
    }



    function exerciseSelectionUI(exercises) {
      const container = document.querySelector(".mde-exercise-selection-section");
      if (!container) return;

      container.innerHTML = "<h4>èª²é¡Œä¸€è¦§</h4>";
      exercises.forEach((ex, i) => {
        const btn = document.createElement("button");
        btn.textContent = `èª²é¡Œ ${i + 1}: ${ex.exerciseInfo}`;
        btn.classList.add("mde-select-button");
        btn.addEventListener("click", async () => {
          console.log(`é¸æŠã•ã‚ŒãŸèª²é¡Œ: ${ex.id}`);

          // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼åœæ­¢ï¼ˆå¿µã®ãŸã‚ï¼‰
          if (window.player?.stopAll) {
            player.stopAll();
          }

          // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å†ç”Ÿæˆ
          window.player = new MDEPlayer(ex, renderOptions);
          await player.init();

          // UI æ›´æ–°
          document.querySelector(".mde-exercise-info").textContent = ex.exerciseInfo;
          displayExerciseInfo(document.querySelector(".mde-playback-info"), ex);
          await player.loadAndDisplayScore("answer-score-container");

          // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼UIè¤‡è£½
          const tmpl = document.getElementById("mde-player-template");
          ["exercise-player-section", "answer-player-section"].forEach(id => {
            const sec = document.getElementById(id);
            if (sec) {
              sec.textContent = "";
              sec.appendChild(tmpl.content.cloneNode(true));
              setupPlayerUI(sec);
            }
          });

          // èª²é¡Œã‚¿ãƒ–ã¸è‡ªå‹•åˆ‡ã‚Šæ›¿ãˆ
          document.querySelector('[data-tab="exercise"]')?.click();
        });

        container.appendChild(btn);
      });
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // åˆæœŸåŒ–ï¼šJSONæ¤œè¨¼ï¼‹playerç”Ÿæˆï¼‹UIæ§‹ç¯‰
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function initializeApp() {
      console.log("initializeApp: start");

      // JSON + Schema èª­ã¿è¾¼ã¿
      const rawJson = document.getElementById("mde-json-data").textContent.trim();
      const rawSchema = document.getElementById("mde-json-schema").textContent.trim();
      let exercises, schema;
      try {
        exercises = JSON.parse(rawJson);
        schema = JSON.parse(rawSchema);
      } catch (e) {
        showFatalJsonError([`JSON/Schema parse error: ${e.message}`]);
        return;
      }

      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      const ajv = new Ajv();
      const validate = ajv.compile(schema);
      if (!validate(exercises)) {
        const msgs = validate.errors.map(err => `${err.instancePath || err.schemaPath} ${err.message}`);
        showFatalJsonError(msgs);
        return;
      }

      // JSON ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é€šéå¾Œã«è¿½åŠ 
      exerciseSelectionUI(exercises);  // â†è¿½åŠ ï¼

      // èª²é¡Œãƒ‡ãƒ¼ã‚¿å–ã‚Šå‡ºã—
      const exercise = exercises[0];

      // player ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆãƒ»åˆæœŸåŒ–
      window.player = new MDEPlayer(exercise, renderOptions);
      await player.init();

      // UI æƒ…å ±è¡¨ç¤º
      document.querySelector(".mde-exercise-info").textContent = exercise.exerciseInfo;
      const infoEl = document.querySelector(".mde-playback-info");
      displayExerciseInfo(infoEl, exercise); // ã“ã“ãŒå¤‰æ›´ç‚¹

      // è§£ç­”æ¥½è­œã‚’å…¨ä½“è¡¨ç¤º
      await player.loadAndDisplayScore("answer-score-container");

      // ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼UIã‚’è¤‡è£½ï¼†ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      const tmpl = document.getElementById("mde-player-template");
      ["exercise-player-section", "answer-player-section"].forEach(id => {
        const sec = document.getElementById(id);
        if (sec) {
          sec.textContent = "";
          sec.appendChild(tmpl.content.cloneNode(true));
          setupPlayerUI(sec);
        }
      });

      console.log("initializeApp: complete");
    }

    document.addEventListener("DOMContentLoaded", initializeApp);

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ä»–ãƒ•ã‚¡ã‚¤ãƒ«ã«ç§»è¡Œã™ã‚‹é–¢æ•°ç¾¤
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function displayExerciseInfo(infoEl, exercise) {
      if (infoEl) {
        let html = `<h4>ãƒ—ãƒ¬ã‚¤ãƒãƒƒã‚¯æƒ…å ±</h4>
        <table><thead><tr><th>#</th><th>ç¯„å›²</th><th>ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒ«(ç§’)</th></tr></thead><tbody>`;
        exercise.playbackDef.forEach((item, i) => {
          html += `<tr><td>${i + 1}</td><td>${item.range}</td><td>${item.interval}</td></tr>`;
        });
        infoEl.innerHTML = html + "</tbody></table>";
      }
    }
  </script>


</body>

</html>



<!-- 
ä»¥ä¸‹ãŒæœ€æ–°ã®ã€ŒMock Dictation Examã€ãƒšãƒ¼ã‚¸ç”¨ã®**æ›´æ–°æ¸ˆã¿å¼•ãç¶™ãè³‡æ–™**ã§ã™ã€‚
ä»Šæ—¥è¡Œã£ãŸã€Œèª²é¡Œé¸æŠUIã®å®Ÿè£…ã€ã¨ã€Œã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæŒ™å‹•ã€ã®çŸ¥è¦‹ã‚’ã™ã¹ã¦åæ˜ æ¸ˆã¿ã§ã™ã€‚

---

## âœ… å¼•ãç¶™ãè³‡æ–™ï¼ˆæ›´æ–°ç‰ˆï¼‰

### 0. ç¾çŠ¶ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆ

* **è¡¨ç¤º**ï¼šè§£ç­”æ¥½è­œã«ã¯ `measureRange` ç„¡æŒ‡å®šã§ `<sb />`ï¼ˆæ®µåŒºåˆ‡ã‚Šï¼‰ã‚’åæ˜ ã€‚`renderOptions` ã«ã‚ˆã‚Š2æ®µç›®ã®å¹…ã‚‚å®‰å®šã€‚
* **å†ç”Ÿæ©Ÿèƒ½**ï¼š

  * ãƒˆãƒ‹ãƒƒã‚¯ã‚³ãƒ¼ãƒ‰ â†’ ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆå†ç”Ÿï¼ˆrange + intervalï¼‰â†’ çµ‚äº†ãƒ™ãƒ«ã€‚
  * `Tone.js` ã«ã‚ˆã‚‹å†ç”Ÿã€‚éŸ³é‡èª¿æ•´ã€ãƒŸãƒ¥ãƒ¼ãƒˆã€åœæ­¢å¯ã€‚
* **JSONä»•æ§˜**ï¼šå®Œå…¨ã«SchemaåŒ–æ¸ˆã¿ï¼ˆAjvã«ã‚ˆã‚‹æ¤œè¨¼ï¼‰ã€‚
* **èª²é¡Œé¸æŠ**ï¼šè¤‡æ•°èª²é¡ŒãŒã€Œèª²é¡Œé¸æŠã€ã‚¿ãƒ–ã«ãƒœã‚¿ãƒ³ã¨ã—ã¦è¡¨ç¤ºã•ã‚Œã€é¸æŠã§ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨UIã‚’å†æ§‹ç¯‰ã€‚

---

### 1. å®Œäº†æ¸ˆã¿ãƒªã‚¹ãƒˆï¼ˆãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ç¢ºèªç”¨ï¼‰

| âœ… | å†…å®¹                                    |
| - | ------------------------------------- |
| âœ… | JSONä»•æ§˜ç­–å®šï¼ˆChordSpec, playbackDef, etcï¼‰ |
| âœ… | JSON Schemaä½œæˆï¼‹Ajvæ¤œè¨¼å°å…¥                 |
| âœ… | `<sb />`ã‚’æ´»ã‹ã—ãŸè§£ç­”è¡¨ç¤ºï¼ˆå…¨å°ç¯€è¡¨ç¤ºï¼‰              |
| âœ… | `renderOptions` ã«ã‚ˆã‚‹2æ®µç›®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä¿®æ­£         |
| âœ… | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã® `stopAll()` ã«ã‚ˆã‚‹å†ç”Ÿä¸­æ–­ã®å …ç‰¢åŒ–        |
| âœ… | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼UIã®2ã‚¿ãƒ–åˆ†è¤‡è£½ç”Ÿæˆ                      |
| âœ… | **èª²é¡Œé¸æŠæ©Ÿèƒ½ã®å®Ÿè£…ï¼ˆä»Šæ—¥ã®ä½œæ¥­ï¼‰**                  |
| âœ… | èª²é¡Œé¸æŠå¾Œã€è‡ªå‹•ã§ã€Œèª²é¡Œã€ã‚¿ãƒ–ã«é·ç§»ï¼ˆ`click()`ã§åˆ‡æ›¿ï¼‰      |

---

### 2. æœªè§£æ±ºï¼ä¿ç•™äº‹é …ï¼ˆèª²é¡Œãƒ¡ãƒ¢ï¼‰

| â“  | å†…å®¹                                 |
| -- | ---------------------------------- |
| ğŸŸ¡ | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼UIï¼šã‚¿ãƒ–ã”ã¨ã®è¤‡è£½ vs å˜ä¸€ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹é‹ç”¨      |
| ğŸŸ¡ | éŸ³é‡ã‚«ãƒ¼ãƒ–ï¼šç¾åœ¨ã¯ -60ã€œ0dBã®ç·šå½¢å¤‰æ›ã€‚æŒ‡æ•°ã‚«ãƒ¼ãƒ–è¦æ¤œè¨    |
| ğŸŸ¡ | WPåŸ‹è¾¼æ‰‹é †ã®æ–‡æ›¸åŒ–ï¼ˆJSONåŸ‹ã‚è¾¼ã¿ãƒ»CDNèª­è¾¼ãƒ»æ›´æ–°æ–¹æ³•ï¼‰    |
| ğŸŸ¡ | MIDIã‚„MEIã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ï¼ˆService Workerãªã©ï¼‰ |
| ğŸ”µ | ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ï¼å¤šè¨€èªå¯¾å¿œã¯å¾Œå›ã—                 |
| ğŸ”µ | GA/è§£æå°å…¥ã‚‚å¾Œå›ã—ï¼ˆä»Šã¯ãªã—ï¼‰                  |

---

### 3. æ¬¡ã®ä½œæ¥­ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆ

#### âœ… MUSTï¼ˆæœ€å„ªå…ˆï¼‰

|  # | ã‚¿ã‚¹ã‚¯             | å†…å®¹                   | å®Œäº†æ¡ä»¶               |
| -: | --------------- | -------------------- | ------------------ |
|  1 | UIã¨ãƒ­ã‚¸ãƒƒã‚¯ã®è²¬å‹™åˆ†é›¢    | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®å†ç”Ÿãƒ­ã‚¸ãƒƒã‚¯ã‚’ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åŒ–  | `MDEPlayer` ã®è²¬å‹™æ˜ç¢ºåŒ– |
|  2 | WPçµ„ã¿è¾¼ã¿æ‰‹é †ãƒ¡ãƒ¢ä½œæˆ    | JSONè¨­ç½®ã¨CDNå‘¼ã³å‡ºã—æ‰‹é †ã¾ã¨ã‚  | Markdownã§å¼•ç¶™ãå¯èƒ½ã«    |
|  3 | âœ… **èª²é¡Œé¸æŠæ©Ÿèƒ½ã®å®Ÿè£…** | ãƒœã‚¿ãƒ³ã§åˆ‡ã‚Šæ›¿ãˆå¯èƒ½ã«ã—ã€ã‚¿ãƒ–é·ç§»ã‚‚å¯¾å¿œ | **å®Œäº†ï¼ï¼ˆæœ¬æ—¥ï¼‰**        |

#### ğŸŸ¡ SHOULDï¼ˆå“è³ªå‘ä¸Šï¼‰

|  # | ã‚¿ã‚¹ã‚¯         | å†…å®¹                       | å®Œäº†æ¡ä»¶               |
| -: | ----------- | ------------------------ | ------------------ |
|  4 | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼UIã®å˜ä¸€åŒ– | è¤‡è£½ã›ãšä½¿ã„ã¾ã‚ã™æ§‹é€ ã¸ãƒªãƒ•ã‚¡ã‚¯ã‚¿        | ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼çŠ¶æ…‹ã‚’ç¶­æŒå¯èƒ½ã«      |
|  5 | ã‚¨ãƒ©ãƒ¼è¡¨ç¤ºå¼·åŒ–     | fetch/Tone/MIDI å¤±æ•—æ™‚ã«æ˜ç¤ºè¡¨ç¤º | æƒ³å®šã‚±ãƒ¼ã‚¹ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã«è¡¨ç¤ºã•ã‚Œã‚‹ |
|  6 | JSONç·¨é›†UI    | playbackDefç·¨é›†UIã®å°å…¥ï¼ˆä»»æ„ï¼‰   | æœ€ä½é™GUIã§å‹•ã          |
|  7 | ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¡¨ç¤º    | ç¾åœ¨ã®range/Transportãªã©è¡¨ç¤º   | ãƒ†ã‚¹ãƒˆãƒ»æ¤œè¨¼æ™‚ã«æœ‰ç”¨         |

#### ğŸ”µ NICE TO HAVE

|  # | ã‚¿ã‚¹ã‚¯      | å†…å®¹               |
| -: | -------- | ---------------- |
|  8 | ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥  | SWãªã©ã§MEI/MIDIé«˜é€ŸåŒ– |
|  9 | ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ | ARIA, ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰å¯¾å¿œ    |
| 10 | GA/è§£æå°å…¥  | åˆ©ç”¨ãƒ‡ãƒ¼ã‚¿ã®å–å¾—æº–å‚™       |
| 11 | å›½éš›åŒ–      | è‹±èªUIå¯¾å¿œä¸‹åœ°         |

---

### 4. æ¬¡å›é–‹å§‹æ™‚ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆ15åˆ†ã§å¾©å¸°ã™ã‚‹ãŸã‚ï¼‰

1. `main script` ã®æœ€æ–°ç‰ˆã‚’é–‹ãï¼ˆHTMLå†…scriptï¼‰
2. `renderOptions` ãŒä¹±ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
3. JSONå·®ã—æ›¿ãˆ â†’ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é€šéã‹å³ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹
4. å†ç”Ÿã®æµã‚Œï¼šãƒˆãƒ‹ãƒƒã‚¯â†’playlistâ†’çµ‚äº†ãƒ™ãƒ«
5. åœæ­¢ãƒ»ãƒŸãƒ¥ãƒ¼ãƒˆãƒ»ãƒœãƒªãƒ¥ãƒ¼ãƒ åå¿œã‚’ç¢ºèª
6. **ã€Œèª²é¡Œé¸æŠã€ã‚¿ãƒ–ã‹ã‚‰åˆ¥èª²é¡Œã«åˆ‡ã‚Šæ›¿ãˆã€æ­£å¸¸å‹•ä½œã™ã‚‹ã‹**

---

### 5. ã‚³ãƒ¼ãƒ‰ãƒ¡ãƒ¢ï¼ˆé¸æŠæ™‚ã®ã‚¿ãƒ–ç§»å‹•ï¼‰

```js
document.querySelector('[data-tab="exercise"]')?.click();
```

* `SimpleTabComponent` ã¯ `.tab-button` ã«ã‚¤ãƒ™ãƒ³ãƒˆå§”è­²ã—ã¦ãŠã‚Šã€`.click()` ã¯ãã®ã¾ã¾ `activateTab()` ã‚’å‘¼ã³å‡ºã™ãŸã‚ã€**ä»Šã®æ§‹æˆãªã‚‰å•é¡Œãªã—**ã€‚
* å°†æ¥çš„ã«æ˜ç¤ºçš„ã« `activateTab()` ã‚’ä½¿ã„ãŸã„å ´åˆã¯ `SimpleTabComponent` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ã—ã¦ `activateTab(buttonEl)` ã‚’ä½¿ã†æ–¹ãŒãƒ™ã‚¿ãƒ¼ã€‚

---

### 6. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å¯¾å¿œè¡¨ï¼ˆç¾çŠ¶ï¼‰

| ãƒ•ã‚¡ã‚¤ãƒ«                     | å½¹å‰²                        | å‚™è€ƒ                 |
| ------------------------ | ------------------------- | ------------------ |
| `index.html`             | UIï¼‹ãƒ­ã‚¸ãƒƒã‚¯è¨˜è¿°ï¼ˆWordPressã«åŸ‹ã‚è¾¼ã¿ï¼‰ | JSONãƒ‡ãƒ¼ã‚¿ã‚‚ã“ã“ã«å«ã‚€      |
| `verovio-manager.min.js` | Verovioé«˜ãƒ¬ãƒ™ãƒ«API            | renderOptionsã®æ‰±ã„é‡è¦ |
| `tonejs/*`               | Tone.js ãƒ­ãƒ¼ãƒ€ãƒ¼ç³»             | CDNã‹ã‚‰å–å¾—ï¼versionå›ºå®š  |
| `simple-tab-component`   | ã‚¿ãƒ–UIç®¡ç†                    | ãƒ‡ã‚£ãƒ¼ãƒ—ãƒªãƒ³ã‚¯å¯¾å¿œæ¸ˆã¿        |

---

### 7. å°†æ¥ã®æ‹¡å¼µã‚¢ã‚¤ãƒ‡ã‚£ã‚¢ï¼ˆParking Lotï¼‰

* MEIè‡ªå‹•ç”Ÿæˆ or å•é¡Œãƒãƒ³ã‚¯çš„ã«æ•´å‚™
* æ¡ç‚¹ä»˜ãç·´ç¿’ãƒšãƒ¼ã‚¸ï¼ˆåˆ¥ãƒšãƒ¼ã‚¸ï¼‰
* è¤‡åˆrangeæŒ‡å®š `"1-2,4,6-7"` ã®å†ç”Ÿå¯¾å¿œ
* UIã‚«ã‚¹ã‚¿ãƒ ï¼šé…è‰²ãƒ»ã‚¹ãƒãƒ›æœ€é©åŒ–
* éµç›¤ãƒ“ãƒ¥ãƒ¼ã‚„ã€éŸ³é«˜è¡¨ç¤ºã®è£œåŠ©

---

å¿…è¦ã«å¿œã˜ã¦ã€ã“ã®å†…å®¹ã‚’Markdownãªã©ã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã§ãã¾ã™ã€‚
ã“ã®ã¾ã¾ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†… `README` ã«çµ„ã¿è¾¼ã¿ã¾ã—ã‚‡ã†ã‹ï¼Ÿï¼ˆã‚ã‚‹ã„ã¯ `docs/README-dictation.md` ãªã©åˆ†é›¢ã—ã¦ã‚‚OKã§ã™ï¼‰

 -->